<!DOCTYPE html>
<html>
<head>
	
	<title>sicp-3-3-3 - kamelzcs's library</title>
	
	
	<meta name="author" content="kamelzcs" />
	
	<meta name="description" content="kamelzcs's library sicp-3-3-3" />
	

	

	<meta name="robots" content="noodp, nydir" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	
	<link href="/css/blueprint/screen.css" type="text/css" rel="stylesheet" />
	<!--[if lt IE 8]> <link href="/css/blueprint/ie.css" type="text/css" rel="stylesheet" /> <![endif]-->	 
	<link href="/css/railscasts.css" type="text/css" rel="stylesheet" />
	<link href="/css/site.css" type="text/css" rel="stylesheet" />

	<script type="text/javascript" src="/js/writeCapture-1.0.5-nolib-min.js"></script>
		<script type="text/javascript" src="/js/jquery.js"></script>
	<script type="text/javascript" src="/js/site.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-45986644-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

	<script src="https://www.google.com/jsapi" type="text/javascript"></script>
  <script language="Javascript" type="text/javascript">
  //<![CDATA[
google.load("search", "1");

function OnLoad() {
	// Create a search control
	var searchControl = new google.search.SearchControl();
	
	// Add in a WebSearch
	var webSearch = new google.search.WebSearch();
	
	// Restrict our search to pages from this site
	webSearch.setSiteRestriction('kamelzcs.github.com');
	
	// Add the searcher to the SearchControl
	searchControl.addSearcher(webSearch);
	
	// tell the searcher to draw itself and tell it where to attach
	searchControl.draw(document.getElementById("searchcontrol"));
	// Add the value of "Search..." to the input field and a class of .empty
}

google.setOnLoadCallback(function() {
  $(function() {
	OnLoad()
	$(".gsc-input > input").val("Search... powered by Google").addClass("empty");
	 
	// When you click on #search
	$(".gsc-input > input").focus(function(){
	 
		// If the value is equal to "Search..."
		if($(this).val() == "Search... powered by Google") {
			// remove all the text and the class of .empty
			$(this).val("").removeClass("empty");;
		}
		this.select();
	});
	 
	// When the focus on #search is lost
	$(".gsc-input > input").blur(function(){
	 
		// If the input field is empty
		if($(this).val() == "") {
			// Add the text "Search..." and a class of .empty
			$(this).val("Search... powered by Google").addClass("empty");
		}
	});

	$("#comment_heading").click(function()
	{
		$(this).next("#disqus_thread").slideToggle(500);
		if($(this).text() == "Show Comments") {
			$(this).text("Hide Comments")
		}else{
			$(this).text("Show Comments")
		}
	});
		
  });
});


  //]]>
  </script>


	<!-- mathjax config similar to math.stackexchange -->
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
	  jax: ["input/TeX", "output/HTML-CSS"],
	  tex2jax: {
		inlineMath: [ ['$', '$'] ],
		displayMath: [ ['$$', '$$']],
		processEscapes: true,
		skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
	  },
	  messageStyle: "none",
	  "HTML-CSS": {
		  preferredFont: "TeX",
		  availableFonts: ["STIX","TeX"],
		  }
	});
	</script>
	<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
	<!-- mathjax css conflict with pygments -->
	<style>
	.MathJax .mo,
	.MathJax .mi {
	  color: inherit;
	</style>

</head>

<body>
	<div class="container">
	<!-- <div class="container showgrid"> -->
		<div id="header" class="span-24">
  <div id="menu" class="span-15 last">
    <ul>
      <li class="first"><a href="/">Home</a></li>
      <li><a href="/about">About</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/archives">Archives</a></li>
      <li><a href="/projects">Projects</a></li>
      <!--<li class="last"><a id="mail" href="mailto:kamelzcs@gmail.com">Contact</a></li>-->
    </ul>
  </div>
</div>

		
		<div id="main" class="span-17">
			<style type="text/css">
h3,h4{ 
	color: #335E8D;
}			
h3,h4 {
	margin-left		: 3px;
	font-variant	: small-caps;
	font-weight		: normal;
	border-bottom : 1px dotted #ccc;	
}
</style>




<div class="post" id="main-content">
	<h1>sicp-3-3-3</h1>
	<h4 class="large-bottom">
		Posted on February 27, 2015
		 in <a href="/categories/sicp">SICP</a> 

		<span class="tag-list">
			
			<a href="/tags/lisp">Lisp</a>
			
		</span>
	</h4>
	
	<div class="content">
		<h4 id="section">3.24</h4>

<div class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-table</span> <span class="nv">same-key?</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">local-table</span> <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;*table*</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">assoc </span><span class="nv">key</span> <span class="nv">records</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">records</span><span class="p">)</span> <span class="no">#f</span><span class="p">)</span>
            <span class="p">((</span><span class="nf">same-key?</span> <span class="nv">key</span> <span class="p">(</span><span class="nb">caar </span><span class="nv">records</span><span class="p">))</span> <span class="p">(</span><span class="nb">car </span><span class="nv">records</span><span class="p">))</span>
            <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">assoc </span><span class="nv">key</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">records</span><span class="p">)))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lookup</span> <span class="nv">key-1</span> <span class="nv">key-2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">subtable</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">key-1</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">local-table</span><span class="p">))))</span>
      <span class="p">(</span><span class="k">if </span><span class="nv">subtable</span>
        <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">record</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">key-2</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">subtable</span><span class="p">))))</span>
          <span class="p">(</span><span class="k">if </span><span class="nv">record</span>
            <span class="p">(</span><span class="nb">cdr </span><span class="nv">record</span><span class="p">)</span>
            <span class="no">#f</span>
            <span class="p">))</span>
        <span class="no">#f</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">insert!</span> <span class="nv">key-1</span> <span class="nv">key-2</span> <span class="nv">value</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">subtable</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">key-1</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">local-table</span><span class="p">))))</span>
      <span class="p">(</span><span class="k">if </span><span class="nv">subtable</span>
        <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">record</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">key-2</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">subtable</span><span class="p">))))</span>
          <span class="p">(</span><span class="k">if </span><span class="nv">record</span>
            <span class="p">(</span><span class="nb">set-cdr! </span><span class="nv">record</span> <span class="nv">value</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">set-cdr! </span><span class="nv">subtable</span> <span class="p">(</span><span class="nf">cons</span>
                                 <span class="p">(</span><span class="nb">cons </span><span class="nv">key-2</span> <span class="nv">value</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nb">cdr </span><span class="nv">subtable</span><span class="p">)))))</span>
        <span class="p">(</span><span class="nb">set-cdr! </span><span class="nv">local-table</span> <span class="p">(</span><span class="nf">cons</span>
                                <span class="p">(</span><span class="nb">list </span><span class="nv">key-1</span>
                                      <span class="p">(</span><span class="nb">cons </span><span class="nv">key-2</span> <span class="nv">value</span><span class="p">))</span>
                                <span class="p">(</span><span class="nb">cdr </span><span class="nv">local-table</span><span class="p">))))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dispatch</span> <span class="nv">m</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">eq? </span><span class="nv">m</span> <span class="ss">&#39;lookup-proc</span><span class="p">)</span> <span class="nv">lookup</span><span class="p">)</span>
          <span class="p">((</span><span class="nb">eq? </span><span class="nv">m</span> <span class="ss">&#39;insert-proc!</span><span class="p">)</span> <span class="nv">insert!</span><span class="p">)</span>
          <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">error</span> <span class="s">&quot;Unkown operation -- TABLE&quot;</span> <span class="nv">m</span><span class="p">))))</span>
  <span class="nv">dispatch</span><span class="p">))</span></code></pre></div>

<h4 id="section-1">3.25</h4>

<div class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fold-left</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">seq</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">ans</span> <span class="nv">res</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">res</span><span class="p">)</span>
      <span class="nv">ans</span>
      <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">ans</span> <span class="p">(</span><span class="nb">car </span><span class="nv">res</span><span class="p">))</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">res</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">iter</span> <span class="nv">init</span> <span class="nv">seq</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-table</span> <span class="nv">same-key?</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">associate</span> <span class="nv">key</span> <span class="nv">records</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">records</span><span class="p">)</span> <span class="no">#f</span><span class="p">)</span>
          <span class="p">((</span><span class="nf">same-key?</span> <span class="nv">key</span> <span class="p">(</span><span class="nb">caar </span><span class="nv">records</span><span class="p">))</span>
           <span class="p">(</span><span class="nb">car </span><span class="nv">records</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">else</span>
             <span class="p">(</span><span class="nf">associate</span> <span class="nv">key</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">records</span><span class="p">)))))</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">the-table</span> <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;*table*</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lookup</span> <span class="nv">keys</span><span class="p">)</span>
      <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lookup-record</span> <span class="nv">record-list</span> <span class="nv">key</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="nv">record-list</span>
          <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">record</span> <span class="p">(</span><span class="nf">associate</span> <span class="nv">key</span> <span class="nv">record-list</span><span class="p">)))</span>
            <span class="p">(</span><span class="k">if </span><span class="nv">record</span>
              <span class="p">(</span><span class="nb">cdr </span><span class="nv">record</span><span class="p">)</span>
              <span class="no">#f</span><span class="p">))</span>
          <span class="no">#f</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">fold-left</span> <span class="nv">lookup-record</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">the-table</span><span class="p">)</span> <span class="nv">keys</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">insert!</span> <span class="nv">keys</span> <span class="nv">value</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">descend</span> <span class="nv">table</span> <span class="nv">key</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">record</span> <span class="p">(</span><span class="nf">associate</span> <span class="nv">key</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">table</span><span class="p">))))</span>
        <span class="p">(</span><span class="k">if </span><span class="nv">record</span>
          <span class="nv">record</span>
          <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">new</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">list </span><span class="nv">key</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">cdr </span><span class="nv">table</span><span class="p">))))</span>
            <span class="p">(</span><span class="nb">set-cdr! </span><span class="nv">table</span> <span class="nv">new</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">car </span><span class="nv">new</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">set-cdr! </span><span class="p">(</span><span class="nf">fold-left</span> <span class="nv">descend</span> <span class="nv">the-table</span> <span class="nv">keys</span><span class="p">)</span>
              <span class="nv">value</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dispatch</span> <span class="nv">m</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">eq? </span><span class="nv">m</span> <span class="ss">&#39;lookup</span><span class="p">)</span> <span class="nv">lookup</span><span class="p">)</span>
          <span class="p">((</span><span class="nb">eq? </span><span class="nv">m</span> <span class="ss">&#39;insert!</span><span class="p">)</span> <span class="nv">insert!</span><span class="p">)</span>
          <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">error</span> <span class="s">&quot;Undefined method&quot;</span> <span class="nv">m</span><span class="p">))))</span>
    <span class="nv">dispatch</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">op-table</span> <span class="p">(</span><span class="nf">make-table</span> <span class="nv">eq?</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">put</span> <span class="p">(</span><span class="nf">op-table</span> <span class="ss">&#39;insert!</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">get</span> <span class="p">(</span><span class="nf">op-table</span> <span class="ss">&#39;lookup</span><span class="p">))</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">letters</span> <span class="nv">a</span><span class="p">)</span> <span class="mi">97</span><span class="p">)</span>  <span class="c1">; Two dimensions</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">letters</span> <span class="nv">b</span><span class="p">)</span> <span class="mi">98</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">math</span> <span class="nv">+</span><span class="p">)</span> <span class="mi">43</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">math</span> <span class="nv">-</span><span class="p">)</span> <span class="mi">45</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">math</span> <span class="nv">*</span><span class="p">)</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">greek</span> <span class="nv">majiscule</span> <span class="err">Λ</span><span class="p">)</span> <span class="mi">923</span><span class="p">)</span>  <span class="c1">; Three dimensions</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">greek</span> <span class="nv">miniscule</span> <span class="err">λ</span><span class="p">)</span> <span class="mi">955</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">min</span><span class="p">)</span> <span class="mi">42</span><span class="p">)</span>  <span class="c1">; One dimension</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">max</span><span class="p">)</span> <span class="mi">955</span><span class="p">)</span>
<span class="p">(</span><span class="nf">get</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">min</span><span class="p">))</span>
<span class="p">(</span><span class="nf">get</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">letters</span> <span class="nv">b</span><span class="p">))</span>
<span class="p">(</span><span class="nf">put</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">min</span><span class="p">)</span> <span class="mi">43</span><span class="p">)</span>  <span class="c1">; update</span>
<span class="p">(</span><span class="nf">get</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">min</span><span class="p">))</span></code></pre></div>

<p>This is a hard problem for me, as recursive problem is always hard for me to understand.
<a href="http://community.schemewiki.org/?sicp-ex-3.25">schemewiki</a> provides a great base for this problem, especially the <code>fold-left</code> is used,
which simplifies the logic a lot.</p>

<p>Recursive relies on split the problem into smaller consistently defined subproblems.</p>

<div class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">((</span><span class="nf">k11</span>
   <span class="p">(</span><span class="nf">k12</span>
     <span class="p">(</span><span class="nf">k13</span> <span class="nv">v1</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">k21</span>
   <span class="p">(</span><span class="nf">k22</span>
     <span class="p">(</span><span class="nf">k23</span> <span class="nv">v2</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">k31</span>
   <span class="p">(</span><span class="nf">k32</span> <span class="nv">v3</span><span class="p">)))</span></code></pre></div>

<p>Multi-dimention table looks like this.</p>

<h4 id="section-2">3.26</h4>

<div class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">entry</span> <span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">tree</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">entry-key</span> <span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nb">caar </span><span class="nv">tree</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">entry-value</span> <span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdar </span><span class="nv">tree</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">tree</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr </span><span class="nv">tree</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-tree</span> <span class="nv">entry</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list </span><span class="nv">entry</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">x</span> <span class="nv">set</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">set</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">make-tree</span> <span class="nv">x</span> <span class="o">&#39;</span><span class="p">()</span> <span class="o">&#39;</span><span class="p">()))</span>
        <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">entry-key</span> <span class="nv">set</span><span class="p">))</span>
         <span class="p">(</span><span class="nb">set-cdr! </span><span class="p">(</span><span class="nf">entry</span> <span class="nv">set</span><span class="p">)</span> <span class="nv">x</span><span class="p">))</span>
        <span class="p">((</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">entry-key</span> <span class="nv">set</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">make-tree</span> <span class="p">(</span><span class="nf">entry</span> <span class="nv">set</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">x</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">set</span><span class="p">))</span>
                    <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">set</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">else</span>
          <span class="p">(</span><span class="nf">make-tree</span> <span class="p">(</span><span class="nf">entry</span> <span class="nv">set</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">set</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">x</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">set</span><span class="p">))</span>
                     <span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-table</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">local-table</span> <span class="o">&#39;</span><span class="p">()))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">associate</span> <span class="nv">key</span><span class="p">)</span>
      <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">tree</span><span class="p">)</span>
        <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span> <span class="no">#f</span><span class="p">)</span>
              <span class="p">((</span><span class="nb">= </span><span class="nv">key</span> <span class="p">(</span><span class="nf">entry-key</span> <span class="nv">tree</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">entry</span> <span class="nv">tree</span><span class="p">))</span>
              <span class="p">((</span><span class="nb">&lt; </span><span class="nv">key</span> <span class="p">(</span><span class="nf">entry-key</span> <span class="nv">tree</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">tree</span><span class="p">)))</span>
              <span class="p">(</span><span class="nf">else</span>
                <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">tree</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nf">iter</span> <span class="nv">local-table</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">insert!</span> <span class="nv">key</span> <span class="nv">value</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">record</span> <span class="p">(</span><span class="nf">associate</span> <span class="nv">key</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">if </span><span class="nv">record</span>
          <span class="p">(</span><span class="nb">set-cdr! </span><span class="nv">record</span> <span class="nv">value</span><span class="p">)</span>
          <span class="p">(</span><span class="k">set! </span><span class="nv">local-table</span>
            <span class="p">(</span><span class="nf">adjoin-set</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">key</span> <span class="nv">value</span><span class="p">)</span> <span class="nv">local-table</span><span class="p">)</span>
            <span class="p">))))</span>
     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dispatch</span> <span class="nv">m</span><span class="p">)</span>
       <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">eq? </span><span class="nv">m</span> <span class="ss">&#39;get-proc</span><span class="p">)</span> <span class="nv">associate</span><span class="p">)</span>
             <span class="p">((</span><span class="nb">eq? </span><span class="nv">m</span> <span class="ss">&#39;insert-proc</span><span class="p">)</span> <span class="nv">insert!</span><span class="p">)))</span>
     <span class="nv">dispatch</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">table</span> <span class="p">(</span><span class="nf">make-table</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">get</span> <span class="p">(</span><span class="nf">table</span> <span class="ss">&#39;get-proc</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">put</span> <span class="p">(</span><span class="nf">table</span> <span class="ss">&#39;insert-proc</span><span class="p">))</span>

<span class="p">(</span><span class="nf">put</span> <span class="mi">43</span> <span class="ss">&#39;a</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="mi">42</span> <span class="ss">&#39;b</span><span class="p">)</span>
<span class="p">(</span><span class="nf">get</span> <span class="mi">43</span><span class="p">)</span>
<span class="p">(</span><span class="nf">get</span> <span class="mi">42</span><span class="p">)</span>

<span class="p">(</span><span class="nf">put</span> <span class="mi">43</span> <span class="ss">&#39;e</span><span class="p">)</span>
<span class="p">(</span><span class="nf">get</span> <span class="mi">43</span><span class="p">)</span></code></pre></div>

<h4 id="section-3">3.27</h4>

<div class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">memoize</span> <span class="nv">f</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">table</span> <span class="p">(</span><span class="nf">make-table</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">previously-computed-result</span> <span class="p">(</span><span class="nf">lookup</span> <span class="nv">x</span> <span class="nv">table</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">or </span><span class="nv">previously-computed-result</span>
            <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">result</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">)))</span>
              <span class="p">(</span><span class="nf">insert!</span> <span class="nv">x</span> <span class="nv">result</span> <span class="nv">table</span><span class="p">)</span>
              <span class="nv">result</span><span class="p">))))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">memo-fib</span>
  <span class="p">(</span><span class="nf">memoize</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">n</span><span class="p">)</span>
             <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
                   <span class="p">((</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
                   <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">memo-fib</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
                            <span class="p">(</span><span class="nf">memo-fib</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">2</span><span class="p">))))))))</span></code></pre></div>

<p>The key lies in the <code>memo-fib</code> will share the table cache.</p>


	</div>
	
	<div class="next-prev-nav low-top">
		
		-----------------------------------
		<b>本文内容遵从<a title="Content licenced under Creative Commons by-nc-sa 3.0" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh">CC版权协议</a>转载请注明出自<a href="http://kamelzcs.github.com">kamelzcs</a></b>
		-----------------------------------
		<hr/>
		
		
		
			&laquo;&nbsp;<a href="/2015/02/28/sicp-3-3-4" rel="next" title="sicp-3-3-4">sicp-3-3-4</a>
		
	
		
			
				|
			
		
		
	
		
			<a href="/2015/02/27/sicp-3-3-2" rel="previous" title="sicp-3-3-2">sicp-3-3-2</a>&nbsp;&raquo;
		
	
		<br />
	</div>

	<hr />
	<!--<div class="sharing">
	
	 
	
	
	
	
	
	
	 
</div>
 -->
	

<script type="text/javascript">
      var disqus_shortname = 'kamelzcs';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://kamelzcs.github.com/2015/02/27/sicp-3-3-3';
        var disqus_url = 'http://kamelzcs.github.com/2015/02/27/sicp-3-3-3';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


	<div>
		<h2 id='comment_heading'>Hide Comments</h2>
		<div id="disqus_thread" aria-live="polite"><div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'kamelzcs'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
</div>

		</div>
		
		
			<div id="sidebar" class="span-6 push-1 last">
	<div class="sidebar-module" id='gsearcher'>
				 
		<div id="searchcontrol">
			
		</div>
		
	</div>

	<div class="sidebar-module">
		<div class="title"><a href='/tags'>Tags</a></div>
		
            <span style="font-size: 95%">
              <a href="/tags/app-engine/" title="5 posts">App Engine</a>
            </span>
          
            <span style="font-size: 80%">
              <a href="/tags/bash/" title="2 posts">Bash</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/c++/" title="1 post">C++</a>
            </span>
          
            <span style="font-size: 95%">
              <a href="/tags/database/" title="5 posts">Database</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/datastructure/" title="1 post">Datastructure</a>
            </span>
          
            <span style="font-size: 85%">
              <a href="/tags/git/" title="3 posts">Git</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/github/" title="1 post">Github</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/jekyll/" title="1 post">Jekyll</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/jinja2/" title="1 post">Jinja2</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/life/" title="1 post">Life</a>
            </span>
          
            <span style="font-size: 280%">
              <a href="/tags/lisp/" title="42 posts">Lisp</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/polymorphism/" title="1 post">Polymorphism</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/python/" title="1 post">Python</a>
            </span>
          
            <span style="font-size: 80%">
              <a href="/tags/review/" title="2 posts">Review</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/solarized/" title="1 post">Solarized</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/sourcecode/" title="1 post">Sourcecode</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/template/" title="1 post">Template</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/variable-scope/" title="1 post">Variable scope</a>
            </span>
          
            <span style="font-size: 80%">
              <a href="/tags/vim/" title="2 posts">Vim</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/life/" title="1 post">life</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/亲情/" title="1 post">亲情</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/回忆/" title="1 post">回忆</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/大规模机器学习/" title="1 post">大规模机器学习</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/展望/" title="1 post">展望</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/日本/" title="1 post">日本</a>
            </span>
          
            <span style="font-size: 80%">
              <a href="/tags/生活/" title="2 posts">生活</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/诗歌/" title="1 post">诗歌</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/诗词/" title="1 post">诗词</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/语音/" title="1 post">语音</a>
            </span>
          
            <span style="font-size: 75%">
              <a href="/tags/趋势/" title="1 post">趋势</a>
            </span>
          
	</div>

	<div class="sidebar-module">
		<div class="title"><a href='/categories'>Categories</a></div>
		<a href="/categories/jekyll"><strong>jekyll</strong></a> (1)<br /><a href="/categories/生活"><strong>生活</strong></a> (4)<br /><a href="/categories/语音"><strong>语音</strong></a> (1)<br /><a href="/categories/讲座"><strong>讲座</strong></a> (1)<br /><a href="/categories/technique"><strong>technique</strong></a> (6)<br /><a href="/categories/technology"><strong>technology</strong></a> (4)<br /><a href="/categories/vim"><strong>vim</strong></a> (1)<br /><a href="/categories/诗词"><strong>诗词</strong></a> (1)<br /><a href="/categories/life"><strong>life</strong></a> (3)<br /><a href="/categories/computer"><strong>computer</strong></a> (1)<br /><a href="/categories/linux"><strong>linux</strong></a> (1)<br /><a href="/categories/data-structure"><strong>data structure</strong></a> (1)<br /><a href="/categories/sicp"><strong>sicp</strong></a> (42)<br /><a href="/categories/cc++"><strong>c/c++</strong></a> (1)<br />
	</div>
	
	<div class="sidebar-module">
		<div class="title"><a href='/archives'>Archives</a></div>
		<a href="/2015/05"><strong>May 2015</strong></a> (1)<br /><a href="/2015/03"><strong>March 2015</strong></a> (13)<br /><a href="/2015/02"><strong>February 2015</strong></a> (30)<br /><a href="/2014/02"><strong>February 2014</strong></a> (1)<br /><a href="/2014/01"><strong>January 2014</strong></a> (4)<br /><a href="/2013/12"><strong>December 2013</strong></a> (2)<br /><a href="/2013/11"><strong>November 2013</strong></a> (8)<br /><a href="/2013/10"><strong>October 2013</strong></a> (2)<br /><a href="/2013/03"><strong>March 2013</strong></a> (3)<br /><a href="/2013/02"><strong>February 2013</strong></a> (2)<br /><a href="/2013/01"><strong>January 2013</strong></a> (1)<br /><a href="/2012/12"><strong>December 2012</strong></a> (1)<br />
	</div>
</div>

		
		
		<div id="footer" class="span-24"> 
<span  title="Content licenced under Creative Commons by-nc-sa 3.0">版权所有<a title="Content licenced under Creative Commons by-nc-sa 3.0" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh">&copy;</a> 
	2012-2015 kamelzcs。
</span> 
&nbsp;&nbsp;&nbsp;&nbsp; <a href="https://github.com/kamelzcs">GitHub</a>
&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://weibo.com/u/2534942150">新浪微博</a>
 &nbsp;&nbsp;&nbsp;&nbsp; <a href="http://twitter.com/kamelzcs">Twitter</a>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;
<span>
    主题由<a title="site's theme made by Bilal Hussain" href="http://bilalh.github.com">Bilal Hussain Hussain</a>提供,由<a href="http://ddrccw.github.com">ddrccw</a>修改。
</span>
</div>

	</div>
	
</body>
</html>
